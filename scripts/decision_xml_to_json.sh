#!/bin/bash
xq '. | { chamber: (.TEXTE_JURI_JUDI.META.META_SPEC.META_JURI_JUDI.FORMATION | sub(".*_(?<x>...).*"; "\(.x)") | ascii_downcase), decision_date: .TEXTE_JURI_JUDI.META.META_SPEC.META_JURI.DATE_DEC, ecli: (if (.TEXTE_JURI_JUDI.META.META_SPEC.META_JURI_JUDI.ECLI != null) then .TEXTE_JURI_JUDI.META.META_SPEC.META_JURI_JUDI.ECLI else .TEXTE_JURI_JUDI.META.META_COMMUN.ID end), jurisdiction: (.TEXTE_JURI_JUDI.META.META_SPEC.META_JURI.JURIDICTION | sub("Cour de cassation"; "cc")), number: (if (.TEXTE_JURI_JUDI.META.META_SPEC.META_JURI_JUDI.NUMEROS_AFFAIRES.NUMERO_AFFAIRE | type=="string") then .TEXTE_JURI_JUDI.META.META_SPEC.META_JURI_JUDI.NUMEROS_AFFAIRES.NUMERO_AFFAIRE else .TEXTE_JURI_JUDI.META.META_COMMUN.ID end), publication: ["b","c"], solution: (if (.TEXTE_JURI_JUDI.META.META_SPEC.META_JURI.SOLUTION != null) then (.TEXTE_JURI_JUDI.META.META_SPEC.META_JURI.SOLUTION | ascii_downcase) else "aucune" end), update_date: .TEXTE_JURI_JUDI.META.META_SPEC.META_JURI.DATE_DEC, summary: (if(.TEXTE_JURI_JUDI.TEXTE.SOMMAIRE.ANA."#text" != null) then (.TEXTE_JURI_JUDI.TEXTE.SOMMAIRE.ANA."#text") else (([.TEXTE_JURI_JUDI.TEXTE.BLOC_TEXTUEL | .. | select(. | length > 1000)] | join(" ") ) | .[0:200] ) end), text: ([.TEXTE_JURI_JUDI.TEXTE.BLOC_TEXTUEL | .. | select(. | length > 1000)] | join(" ") ), source: "jurinet", version: 0.7, themes: ["machin", "chose"], zones: {introduction:[{start:0,end:100}],expose:[{start:100,end:200}],moyens:[{start:200,end:300}],motivations:[{start:300,end:400}],dispositif:[{start:400,end:500}]}, sourceId: .TEXTE_JURI_JUDI.META.META_COMMUN.ID, id: .TEXTE_JURI_JUDI.META.META_COMMUN.ID }' ${1} > ${2}
